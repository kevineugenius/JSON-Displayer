<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <p id="output">

  </p>
  <script>
    /************************************************************
     * JSON display made my Kevin Smith
     * This is a hobby project and is probably not perfect,
     * please report what breaks it.
     * 
     * Known issues:
     * comma at start of a string key or value - low priority as it probably doesn't happen that often
     * 
     ************************************************************/
    // Don't change these
    var raw_json = '{"glossary":{"title":"example glossary","GlossDiv":{"title":"S","GlossList":{"GlossEntry":{"ID":"SGML","SortAs":"SGML","GlossTerm":"Standard Generalized Markup Language","Acronym":"SGML","Abbrev":"ISO 8879:1986","GlossDef":{"para":"A meta-markup language, used to create markup languages such as DocBook.","GlossSeeAlso":["GML","XML"]},"GlossSee":"markup"}}}}}';
    var formatted_json = '';
    var tab_count = 0;
    var previous_was_text = false;
    var is_field = true;
    var inside_array = 0; // not boolean to account for nested arrays

    // Formatting decisions
    var newline = '<br>';
    var indent = '&nbsp;';
    var single_quotes = false;
    var indent_size = 2;

    // Color decisions
    var bracket_color = '#0F0';
    var field_color = '#F00';
    var text_color = '#00F';
    var colon_color = '#700';
    var quote_color = '#888';

    // Begin doing work
    raw_json = raw_json.replaceAll("\"", "'"); // get consistency
    if (!single_quotes) {
      raw_json = raw_json.replaceAll("'", "\"");
    }

    formatted_json += '<span style="font-family: \'Courier New\', monospace">';
    for (var i = 0; i < raw_json.length; i++) {
      var char = raw_json.charAt(i);
      var is_text = ",[{}]:\'\"".split(char).length === 1;
      console.log(is_text, char);
      if (is_text) {
        var color = (inside_array > 0) || !is_field ? text_color : field_color;

        if (!previous_was_text) {
          formatted_json += "<span style='color:" + color + "'>" + char;
        } else {
          formatted_json += char;
        }

        previous_was_text = true;
      } else {     
        if (previous_was_text && char !== ',') {
          formatted_json += "</span>";
          previous_was_text = false;
        }
        switch (char) {
          case ',':
            if (previous_was_text) {
              // detecting commas in strings
              formatted_json += ',';
            } else {
              formatted_json += char + newline;
              formatted_json += indent.repeat(indent_size * tab_count);
              is_field = true;
            }
            break;  
          case '[':
            formatted_json += '<span style="color:' + bracket_color + '">';

            formatted_json += char + newline;
            tab_count++;
            formatted_json += indent.repeat(indent_size * tab_count);

            formatted_json += '</span>';
            inside_array++;
            break;
          case '{':
            formatted_json += '<span style="color:' + bracket_color + '">';

            formatted_json += char + newline;
            tab_count++;
            formatted_json += indent.repeat(indent_size * tab_count);

            formatted_json += '</span>';
            is_field = true;
            break;
          case ']':
            inside_array--;
          case '}':
            formatted_json += '<span style="color:' + bracket_color + '">';

            tab_count--;
            formatted_json += newline;
            formatted_json += indent.repeat(indent_size * tab_count) + char;

            formatted_json += '</span>';
            break;
          case ':':
            formatted_json += char + ' ';
            is_field = false;
            break;
          case '\'':
          case '"':
            formatted_json += '<span style="color:' + quote_color + '">';

            formatted_json += char;

            formatted_json += '</span>';
            break;
          default:

        }
      }
    }
    formatted_json += '</span>';

    document.getElementById("output").innerHTML = formatted_json;
  </script>
</body>
</html>